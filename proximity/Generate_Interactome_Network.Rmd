---
title: "Generate Interactome Network"
output: html_notebook
---

# Goal

Generate an protein interactome network object that we can then use to compute proximity scores between gene and drug gene lists. We'll use data from the [Dana Farber reference interactome project](http://www.interactome-atlas.org/). We'll use the `igraph` package to convert these interactions into a network object that we can compute on.

# Setup

## Libraries
```{r}
library(data.table)
library(igraph)
# our own custom functions
# source("functions.R")
```

## Data
```{r}
# read the interactome data
# this is simply a 2-column table with each row representing an interaction
# file has no header line
huri <- fread("HuRI.tsv", header = F)
```

```{r}
# gene annotations from HUGO - will need this to convert ensembl ids to symbols
hugo <- fread("HGNC_gene_with_protein_product_20200702.txt",
              colClasses = c("entrez_id" = "character"))
hugo_small <- unique(hugo[, .(ensembl_gene_id, symbol)])
```

```{r}
# inputs from semantic similarity analysis - we can reuse the gene lists here
inputs <- readRDS("../semantic_similarity/inputs.rds")
```


## Wrangle
```{r}
huri <- merge(huri, hugo_small, by.x="V1", by.y="ensembl_gene_id")
huri <- merge(huri, hugo_small, by.x="V2", by.y="ensembl_gene_id")
# keep only symbols and deduplicate
huri_sym <- unique(huri[, .(symbol.x, symbol.y)])
dim(huri_sym)
```
Ok, so we have ~5k unique interactions. Pretty good.

# Convert to graph object
```{r}
(g <- graph_from_data_frame(huri_sym, directed = F))
# count the number of edges - should be equal to number of rows in data.frame
length(E(g))
```
Ok that looks good. Let's save it.

```{r}
# save
saveRDS(g, "huri_sym_graph.rds")
```

# Filter gene lists
```{r}
# filter each of the disease and drug gene lists so that it contains
# only genes in the graph object
inputs_filt <- inputs[c("drug_targets", "disease_genes")]
universe <- names(V(g))
inputs_filt$disease_genes <- filter_gene_lists(inputs_filt$disease_genes,
                                               universe = universe)
inputs_filt$drug_targets <- sapply(inputs_filt$drug_targets, function(x) {
    filter_gene_lists(x, universe = universe)
}, USE.NAMES = T)
```

```{r}
# save these as one list
inputs <- c(list(graph=g), inputs_filt)
saveRDS(inputs, "inputs.rds")
```

